:root {
  --color-bg: #f1f5f9;
  --color-surface: #ffffff;
  --color-surface-alt: #f8fafc;
  --color-border: #e2e8f0;
  --color-border-strong: #cbd5e1;
  --color-text: #0f172a;
  --color-text-dim: #475569;
  --color-accent: #0ea5e9;
  --color-accent-hover: #0284c7;
  --color-danger: #dc2626;
  --color-danger-hover: #b91c1c;
  --avg-tag-bg: #1e293b; /* price tag bg (light mode) */
  --avg-tag-bg-alt: #334155; /* dark mode variant */
  --radius-sm: 6px;
  --radius-md: 12px;
  --radius-full: 999px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.06);
  --shadow-md: 0 4px 12px -2px rgba(0,0,0,0.08);
  --focus-ring: 0 0 0 3px rgba(14,165,233,0.35);
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
  color-scheme: light dark;
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-bg: #0f172a;
    --color-surface: #1e293b;
    --color-surface-alt: #162132;
    --color-border: #243044;
    --color-border-strong: #334155;
    --color-text: #f1f5f9;
    --color-text-dim: #94a3b8;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.5);
    --shadow-md: 0 4px 16px -2px rgba(0,0,0,0.55);
  --avg-tag-bg: #334155; /* override for dark */
  --avg-tag-bg-alt: #475569;
  }
}

html, body { margin:0; padding:0; background: var(--color-bg); color: var(--color-text); -webkit-font-smoothing: antialiased; }
body { min-height: 100dvh; }

.app-container { max-width: 780px; margin: 0 auto; padding: clamp(12px,2vw,24px); }

.topbar { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:20px; }
.topbar h2 { font-size:1.25rem; font-weight:600; display:flex; align-items:center; gap:.4rem; margin:0; }
.topbar-actions { display:flex; gap:10px; align-items:center; }
/* Topbar icon buttons reuse icon-btn base with slightly larger hit area */
.topbar .icon-btn { width:38px; height:38px; padding:0; border-radius: var(--radius-full); }
.topbar .icon-btn:hover { background: var(--color-surface-alt); }
.icon-btn.spin { animation: rotate 1s linear infinite; }
@keyframes rotate { to { transform: rotate(360deg); } }
/* Larger plus sign without enlarging button */
.plus-btn { position:relative; }
.plus-btn .plus-glyph { display:inline-block; transform: scale(1.4); margin:0 -2px; line-height:1; }

.btn { --bg: var(--color-accent); --bg-hover: var(--color-accent-hover); --txt:#fff; border:none; background:var(--bg); color:var(--txt); padding:.65rem 1.05rem; font-size:.9rem; font-weight:500; border-radius: var(--radius-full); cursor:pointer; display:inline-flex; gap:.4rem; align-items:center; line-height:1; box-shadow: var(--shadow-sm); transition: background .18s, box-shadow .18s, transform .15s; }
.btn:hover:not(:disabled) { background:var(--bg-hover); box-shadow: var(--shadow-md); }
.btn:active:not(:disabled) { transform: translateY(1px); }
.btn:focus-visible { outline:none; box-shadow: var(--focus-ring); }
.btn[disabled] { opacity:.55; cursor:not-allowed; }
.btn-secondary { --bg: var(--color-surface-alt); --bg-hover:#e2e8f0; --txt: var(--color-text); border:1px solid var(--color-border); }
.btn-danger { --bg: var(--color-danger); --bg-hover: var(--color-danger-hover); }

.card { background:var(--color-surface); border:1px solid var(--color-border); border-radius: var(--radius-md); padding:20px; box-shadow: var(--shadow-sm); }
.card + .card { margin-top:16px; }

.tx-header { display:flex; justify-content:space-between; align-items:center; margin:0 0 12px; font-size:1.18rem; font-weight:700; letter-spacing:.3px; }
.tx-header .tx-amt { font-size:inherit; font-weight:inherit; }
.tx-header.collapsible { cursor:pointer; user-select:none; padding:4px 2px; border-radius:8px; transition: background .18s; }
.tx-header.collapsible:hover { background: var(--color-surface-alt); }
.tx-header.collapsible:focus-visible { outline:none; box-shadow: var(--focus-ring); }
.tx-header .chevron { transition: transform .25s ease; }
.tx-header.is-collapsed .chevron { transform: rotate(-90deg); }
.month-group + .month-group { margin-top:20px; }
.tx-list { list-style:none; margin:0; padding:0; }
.tx-row { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 0; border-top:1px solid var(--color-border); }
.tx-row:first-child { border-top:none; }
.tx-meta { font-size:.7rem; letter-spacing:.5px; text-transform:uppercase; color: var(--color-text-dim); }
.tx-amt { font-weight:600; }
.tx-empty { text-align:center; padding:32px 12px; color: var(--color-text-dim); font-size:.9rem; }

.grid2 { display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
@media (max-width:640px) { .grid2 { grid-template-columns:1fr; } }

form label { display:flex; flex-direction:column; gap:4px; font-size:.8rem; font-weight:500; color: var(--color-text-dim); }
input, select { background:var(--color-surface-alt); border:1px solid var(--color-border); padding:.6rem .75rem; border-radius: var(--radius-sm); font:inherit; color:var(--color-text); }
input:focus, select:focus { outline:none; border-color: var(--color-accent); box-shadow: var(--focus-ring); }
/* Enhanced form layout */
.form-card { padding:28px 26px; }
.form-header { margin:0 0 18px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
.form-header h3 { margin:0; font-size:1.05rem; font-weight:600; letter-spacing:.3px; }
.form-stack { display:flex; flex-direction:column; gap:18px; }
.form-row-grid { display:grid; gap:18px; grid-template-columns:1fr 1fr; }
@media (max-width:640px) { .form-row-grid { grid-template-columns:1fr; } }
.field label, form label { font-size:.7rem; font-weight:600; letter-spacing:.5px; text-transform:uppercase; color: var(--color-text-dim); }
.field-input { position:relative; display:flex; align-items:center; }
.field-input input, .field-input select { width:100%; }
/* Custom select arrow */
select { appearance:none; -webkit-appearance:none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' stroke='%23475569' stroke-width='2' fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='4 6 8 10 12 6'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position: right .75rem center; background-size:14px 14px; padding-right:2.2rem; }
@media (prefers-color-scheme: dark) { select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' stroke='%2394a3b8' stroke-width='2' fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='4 6 8 10 12 6'/%3E%3C/svg%3E"); } }
/* Input hover & active states */
input:hover, select:hover { border-color: var(--color-border-strong); }
input:active, select:active { background: var(--color-surface); }
.form-actions { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
/* Narrow helper text style */
.help-text { font-size:.65rem; color: var(--color-text-dim); margin-top:4px; line-height:1.3; }

.inline-actions { display:flex; gap:8px; align-items:center; }

/* Minimal icon button */
.icon-btn { background:transparent; border:1px solid var(--color-border); color: var(--color-text-dim); padding:.3rem .4rem; border-radius: var(--radius-sm); cursor:pointer; display:inline-flex; align-items:center; justify-content:center; line-height:0; transition: background .15s, color .15s, border-color .15s, transform .15s; }
/* Neutral hover for standard icon buttons (refresh/logout) */
.icon-btn:hover { background: var(--color-surface-alt); border-color: var(--color-border-strong); }
.icon-btn:active { transform: scale(.9); }
/* Destructive variant */
.icon-btn.danger { color: var(--color-text-dim); border-color: var(--color-border); }
.icon-btn.danger:hover { background: var(--color-surface-alt); color: var(--color-danger); border-color: var(--color-danger); }
.icon-btn:focus-visible { outline:none; box-shadow: var(--focus-ring); }
.icon-btn svg { width:16px; height:16px; pointer-events:none; }

/* Monthly chart */
.monthly-chart-wrap { position:relative; margin:0 0 20px; }
.monthly-chart { position:relative; display:flex; gap:6px; align-items:flex-end; height:130px; padding:4px 46px 0 2px; }
.monthly-chart-bar { flex:1; max-width:48px; height:100%; position:relative; background:transparent; border:none; border-radius:4px; display:flex; align-items:flex-end; justify-content:center; overflow:visible; min-width:0; }
.monthly-chart-bar.current .fill { box-shadow:0 0 0 1px var(--color-accent); }
.monthly-chart-bar .fill { display:none; }
.monthly-chart-bar .bar-outer { position:absolute; left:0; right:0; bottom:0; display:flex; flex-direction:column; border-radius:4px 4px 0 0; overflow:hidden; box-shadow:0 0 0 1px rgba(255,255,255,0.08),0 1px 2px rgba(0,0,0,0.4); background:rgba(255,255,255,0.04); }
.monthly-chart-bar .bar-outer .seg { width:100%; }
/* Category colors (muted professional palette) */
.seg.cat-coffeeshop, .swatch.cat-coffeeshop { background: linear-gradient(180deg,#4f6d7a,#39515b); }
.seg.cat-hawker, .swatch.cat-hawker { background: linear-gradient(180deg,#8c6239,#6d4a28); }
.seg.cat-food_centre, .swatch.cat-food_centre { background: linear-gradient(180deg,#556b2f,#3d4e21); }
.seg.cat-cafe, .swatch.cat-cafe { background: linear-gradient(180deg,#7a4f7d,#5a395c); }
.seg.cat-restaurant, .swatch.cat-restaurant { background: linear-gradient(180deg,#2f5d62,#204042); }
.seg.cat-buffet, .swatch.cat-buffet { background: linear-gradient(180deg,#805b36,#604427); }
.seg.cat-others, .swatch.cat-others { background: linear-gradient(180deg,#5a5f6a,#3d4149); }
.category-legend { display:flex; gap:14px; flex-wrap:wrap; justify-content:center; margin:0 0 8px 0; font-size:.55rem; letter-spacing:.5px; text-transform:uppercase; }
.legend-item { display:flex; align-items:center; gap:4px; color: var(--color-text-dim); font-weight:600; }
.legend-item .swatch { width:14px; height:8px; border-radius:4px; box-shadow:0 0 0 1px rgba(255,255,255,0.15); }
.monthly-chart-bar.current .fill { background: linear-gradient(180deg,#2f5d62,#204042); }
.monthly-chart-bar span { position:relative; z-index:2; font-size:.55rem; font-weight:500; color: var(--color-text-dim); margin-bottom:4px; letter-spacing:.5px; text-transform:uppercase; }
.monthly-chart-bar .bar-tooltip { position:absolute; top:4px; left:50%; transform:translate(-50%, -110%); background:var(--avg-tag-bg); color:#fff; font-size:.55rem; padding:4px 6px; border-radius:4px; white-space:nowrap; opacity:0; pointer-events:none; transition: opacity .15s, transform .2s; box-shadow:0 2px 6px rgba(0,0,0,0.3); z-index:10; }
.monthly-chart-bar .bar-tooltip:after { content:""; position:absolute; bottom:-4px; left:50%; transform:translateX(-50%); width:8px; height:6px; clip-path:polygon(50% 100%,0 0,100% 0); background:var(--avg-tag-bg); }
.monthly-chart-bar:hover .bar-tooltip, .monthly-chart-bar:focus-visible .bar-tooltip { opacity:1; transform:translate(-50%, -125%); }
.monthly-chart-avg { position:absolute; left:0; right:0; height:1px; opacity:.9; display:flex; align-items:center; }
.monthly-chart-avg:before { content:""; position:absolute; inset:0; background:repeating-linear-gradient(90deg,#fff 0 5px,transparent 5px 7px); }
.monthly-chart-avg-label { position:absolute; right:4px; transform:translateY(50%); font-size:.6rem; background:var(--avg-tag-bg); padding:4px 10px 4px 14px; border:1px solid rgba(255,255,255,0.18); border-radius:6px; color:#fff; font-weight:600; letter-spacing:.35px; line-height:1; box-shadow:0 3px 6px -1px rgba(0,0,0,0.35); }
.monthly-chart-avg-label:before { content:""; position:absolute; left:6px; top:50%; transform:translateY(-50%); width:8px; height:10px; background:var(--avg-tag-bg-alt); clip-path:polygon(0 0,100% 50%,0 100%); border-radius:2px; }
.monthly-chart-avg-label:after { content:""; position:absolute; left:2px; top:50%; transform:translate(-50%,-50%); width:6px; height:6px; background:#fff; border:1px solid rgba(0,0,0,0.25); border-radius:50%; box-shadow:0 0 0 1px rgba(255,255,255,0.25); }

.alert-error { background:#fee2e2; border:1px solid #fecaca; color:#991b1b; padding:.75rem 1rem; border-radius: var(--radius-md); font-size:.8rem; }
@media (prefers-color-scheme: dark) { .alert-error { background:#7f1d1d; border-color:#991b1b; color:#fecaca; } }

.fade-in { animation: fade .3s ease; }
@keyframes fade { from { opacity:0; transform: translateY(4px);} to { opacity:1; transform:translateY(0);} }

.modal-backdrop { position:fixed; inset:0; background:rgba(15,23,42,0.5); backdrop-filter: blur(2px); display:flex; align-items:center; justify-content:center; z-index:80; }
.modal { background:var(--color-surface); border:1px solid var(--color-border); border-radius: var(--radius-md); padding:24px; width:min(92vw,420px); box-shadow: var(--shadow-md); }
.modal h3 { margin:0 0 12px; font-size:1.05rem; }
.modal-footer { margin-top:20px; display:flex; justify-content:flex-end; gap:10px; }

.badge { display:inline-block; background:var(--color-surface-alt); border:1px solid var(--color-border); padding:2px 8px; border-radius: var(--radius-full); font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; color: var(--color-text-dim); }

footer.pwa-hint { margin-top:24px; font-size:.7rem; text-align:center; opacity:.65; }
